"use client";

import { useEffect, useMemo, useState } from "react";
import { convertMarkdownToHtml } from "@/utils/markdownUtils";
import useHeaderConfig from "@/hooks/useHeaderConfig";
import { logger } from "@/lib/logging";
import { currentCommunityConfig } from "@/lib/communities/metadata";

const policyMarkdown = `
共創DAO合同会社（以下「当社」といいます。）は、当社が提供するサービス、運営するイベント、関与するプロジェクトなどの当社の事業（以下「当事業等」といいます。）に関して、当社が取得した個人情報（以下、個人情報によって特定識別される当該本人を「ユーザー」といいます。）の取扱いについて、以下の通りプライバシーポリシー（以下「本ポリシー」といいます。）を定め、プライバシーの適切な保護の重要性と社会的責任を十分に認識し、個人情報の保護に関する法律（以下「個人情報保護法」といいます。）その他の関係法令を遵守いたします。なお、本プライバシーポリシーにおける「個人情報」は、個人情報保護法の定義に従います。

### 1. 個人情報の取り扱いに関する基本方針

#### ① 個人情報の適正な管理
個人情報の漏洩、紛失、消去または毀損を防ぐ防止措置を講じます。

#### ② 個人情報に関する法令等の遵守
当社は、適用される個人情報保護規制に従って、個人情報を処理します。各国毎の処理の法的根拠については、各国別紙をご覧ください。

#### ③ 個人情報に関する問い合わせ
個人情報に関する問い合わせ、開示要求および苦情に対し、適切に対応します。

### 2. 個人情報の取得

当社は個人情報を取得する場合は、個人情報保護法その他の規範を遵守し、適法かつ公正な手段によって、ユーザーから直接またはユーザーが個人情報を提供した第三者から、以下の個人情報を取得いたします。

- 氏名、性別、年齢（生年月日）、所属、学習歴、写真、画像等、プロフィールに関する情報  
- メールアドレス、住所、電話番号等、ご連絡先に関する情報  
- 当社実施するアンケートや調査シート記載の質問に対する回答（上記の個人情報を除く）  
- ID、パスワード等、ユーザー確認に必要となる情報  
- ユーザーの当事業等における申し込み、活動、投稿に関する情報  
- 上記のほか、各当事業等で指定する情報  
- その他上記の各情報に関連する情報  

### 3. 個人情報の利用目的

当社は、取得した個人情報について、違法又は不当な行為を助長し、又は誘発するおそれがある方法により利用せず、また、関係法令等により例外と認められる場合を除き、取得の際に示した利用目的及び以下の利用目的の範囲内で利用します。

#### (1) 当事業等の利用者または参加者
- 各当事業等の申請書類の審査・管理  
- 事務連絡  
- 資料の発送  
- 品質向上  
- 案内・告知・宣伝活動  
- ニュースレター発送  
- 取材・アンケート・活動報告への協力依頼  
- PR活動への利用  
- 関連イベントのPR  
- 広報活動への利用  
- メディアへの提供  
- 閲覧履歴等の情報分析と広告配信  
- トラブル時の調査・確認  
- 統計データの作成・活用  
- 関連業務の実施  

#### (2) 取引業者、業務委託者、ボランティア、インターン等
- 活動依頼・委託・受託  
- 事務連絡  
- 報酬・代金支払  
- 協力依頼  
- 情報発信  
- 媒体掲載  
- 関連業務の実施  

#### (3) 協働事業者、連携者
- 連絡  
- 案内・告知・宣伝活動  
- 協力依頼  
- 情報発信  
- 媒体掲載  
- 関連業務の実施  

#### (4) 資料請求・取材申込・講演依頼等
- 資料送付  
- 回答・事務連絡  
- 情報発信  
- 関連業務の実施  

#### (5) その他
- 上記利用目的に付随する目的での利用およびAIサービスへの入力等  
- 法的要件への対応  
- その他合法的かつ社会的意義のある目的の遂行  

### 4. 個人情報の安全管理

技術的・物理的なセキュリティ対策等を講じ、安全管理に努めます。海外においても必要かつ適切な措置を講じます。

### 5. 個人情報の取り扱いの委託

委託先に対し、当社と同水準の安全管理措置を確保するための監督を行います。

### 6. 第三者開示および提供

以下の場合を除き、第三者に開示・提供しません。

1. 協働事業者等との共有  
2. AIサービス提供者との共有  
3. 業務委託先との共有  
4. 同意がある場合  
5. 法令に基づく場合  
6. 緊急時の人命・財産保護等  
7. 公的機関への協力  
8. 学術研究目的に限る場合  
9. 事業の承継に伴う提供  

法令・要請・権利保護等が必要な場合、当社は個人情報を開示することがあります。

### 7. 海外への個人情報の移転

以下の国に移転されることがあります。

- 米国  
- 日本  

各国の規制に基づき適切な保護措置を実施します。

### 8. クッキー及び類似技術

当社は、クッキー等を用いて情報を取得することがあります。設定変更により無効化可能です。EEA及び英国の法的根拠は別紙を参照。

#### ○ 分析クッキーについて

Googleアナリティクス等のサービスを利用することがあります。

- [Googleのプライバシーポリシー](https://www.google.com/policies/privacy/partners)  
- [Google アナリティクスの無効化](https://tools.google.com/dlpage/gaoptout)

### 9. 第三者のウェブサイト等へのリンク

当社は他サイトのプライバシー管理を行っておらず、各自でポリシーを確認する必要があります。

### 10. 保有個人情報の開示・修正・利用停止等

ユーザー確認後、正当な理由がない限り対応します。各国での権利は別紙を参照。手続きは以下メールアドレスへご連絡ください。

### 11. 通知・公表、本ポリシーの変更

変更時はメールにて通知し、掲載をもって適用されます。継続利用により同意されたとみなします。

### 12. お問合せメールアドレス

お問合せは以下のメールアドレスまでご連絡ください。  
**info@kyosodao.io**


# EEA（欧州経済領域）及び英国別紙

**発効日：2022年6月17日**  
**最終更新日：2022年6月17日**

本別紙は、EEA（欧州経済領域）及び英国に所在又は居住するユーザーに適用され、GDPR及びUK GDPR（以下、単に｢GDPR｣と総称します。）に関するものです。

### 1. 処理の法的根拠

##### 本件サービスのアカウント登録

- **処理の法的根拠**：契約の履行のために処理が必要となる場合（Art. 6.1 b GDPR）  
- **個人データの種類**：登録情報  
- **データ受領者**：処理者（サービスプロバイダー）  
- **EEA/英国域外への個人データの移転**：あり

##### 本件サービスの提供

- **処理の法的根拠**：同上  
- **個人データの種類**：サービス情報  
- **データ受領者**：同上  
- **EEA/英国域外への個人データの移転**：あり

##### ユーザーからのお問い合わせ対応

- **処理の法的根拠**：同上  
- **個人データの種類**：お問い合わせ情報  
- **データ受領者**：同上  
- **EEA/英国域外への個人データの移転**：あり

##### 本件サービス及び付随サービスの提供

- **処理の法的根拠**：同上  
- **個人データの種類**：サービス情報  
- **データ受領者**：同上  
- **EEA/英国域外への個人データの移転**：あり

##### 法的義務の遵守

- **処理の法的根拠**：法的義務を遵守するために取扱いが必要（Art. 6.1 c GDPR）  
- **個人データの種類**：サービス情報  
- **データ受領者**：同上  
- **EEA/英国域外への個人データの移転**：あり

##### 新たなサービス開発およびコンテンツ獲得

- **処理の法的根拠**：ユーザーの同意（Art. 6.1 a GDPR）  
- **個人データの種類**：クッキーその他オンライン識別子  
- **データ受領者**：同上  
- **EEA/英国域外への個人データの移転**：あり

##### 属性分析およびWeb改善

- **処理の法的根拠**：同上  
- **個人データの種類**：同上  
- **データ受領者**：同上  
- **EEA/英国域外への個人データの移転**：あり

##### Web保守・障害調査・修復

- **処理の法的根拠**：正当な利益の追求（Art. 6.1 f GDPR）  
- **個人データの種類**：サービス情報、必須のオンライン識別子  
- **データ受領者**：同上  
- **EEA/英国域外への個人データの移転**：あり

##### セキュリティ確保

- **処理の法的根拠**：同上  
- **個人データの種類**：同上  
- **データ受領者**：同上  
- **EEA/英国域外への個人データの移転**：あり

##### 法的請求権の行使・防御

- **処理の法的根拠**：同上  
- **個人データの種類**：サービス情報  
- **データ受領者**：第三者  
- **EEA/英国域外への個人データの移転**：あり

> 正当な利益のバランシングテストの詳細は、グローバルプライバシーポリシー12.記載の連絡先へお問い合わせください。ユーザーへのダイレクトマーケティングは、必要な場合に限り同意を得たうえで行います。

### 2. 海外への個人データの移転

当社の多くのITシステムは日本国内でホストされています。欧州委員会は日本を十分性認定済みです。  
英国またはEEA域外の処理者へ個人データを転送する際は、GDPR第46条に基づく標準契約条項など適切な措置を講じます。

### 3. ユーザーの権利

- **情報取得権**（GDPR第13条・14条）  
- **アクセス権**（GDPR第15条）  
- **訂正・削除権**（GDPR第16条・17条）  
- **処理制限要求権**（GDPR第18条）  
- **異議申立権**（GDPR第21条）  
- **データポータビリティ権**（GDPR第20条）  
- **同意の撤回権**  
- **自動化された意思決定に対する拒否権**（GDPR第22条）  

EEA居住者は該当監督機関へ、英国居住者はInformation Commissioner's Officeへ苦情を申し立てることができます。


# カリフォルニア州別紙

**発効日：2022年6月17日**  
**最終更新日：2022年6月17日**

本別紙は、カリフォルニア州消費者プライバシー法（CCPA）に基づく情報を含みます。

### アクセシビリティ

視覚障害者の方はスクリーンリーダーでアクセス可能です。その他障害のある方は、6.記載の連絡先からお問い合わせください。

### 1. 収集するカリフォルニア州個人情報のカテゴリー

- a) 識別子（IPアドレス、メールアドレス、アカウント名等）  
- b) カリフォルニア州顧客記録規定に掲げる個人情報（氏名等）  
- c) インターネットまたはネットワーク活動（閲覧履歴等）  

### 2. 情報源のカテゴリー

グローバルプライバシーポリシー5.に記載された情報源より取得。

### 3. 使用目的

グローバルプライバシーポリシー2.に記載された目的で使用。

### 4. 個人情報の受領者

過去12ヶ月間に以下の第三者へ開示：

| カテゴリー | 第三者のカテゴリー |
|------------|---------------------|
| 識別子 | クラウドサービス事業者、カスタマーサポート、利用状況分析者等 |
| 顧客記録規定に掲げる情報 | 同上 |
| インターネット活動 | 同上 |

※販売は行っていません。

### 5. ユーザーの権利

- 収集・使用・開示等に関する情報の開示請求  
- 個人情報の削除請求  
- 個人情報の販売に関するオプトアウト  
- 「シャイン・ザ・ライト」法に基づく情報開示請求と共有拒否  

ユーザーが権利を行使する場合：

- [お問い合わせフォーム](https://animap.io/?m=1)  
- メール: support@animap.io

#### 検証手続き

必要に応じ追加情報を要請することがありますが、アカウント作成は不要です。

#### 代理人

代理人による請求も可能ですが、書面での承認証明が必要です。

### 6. 詳細な情報についての連絡先

グローバルプライバシーポリシー12.（連絡先）をご参照ください。
`;

export default function PrivacyPage() {
  const headerConfig = useMemo(
    () => ({
      title: "プライバシーポリシー",
      showBackButton: true,
      showLogo: false,
    }),
    [],
  );
  useHeaderConfig(headerConfig);

  const [html, setHtml] = useState("");

  useEffect(() => {
    const privacyOverride = currentCommunityConfig.commonDocumentOverrides?.privacy;
    
    if (privacyOverride && privacyOverride.type === "external") {
      window.location.href = privacyOverride.path;
      return;
    }

    convertMarkdownToHtml(policyMarkdown).then(setHtml).catch((error) => {
      logger.warn("Failed to convert markdown to HTML", {
        error: error instanceof Error ? error.message : String(error),
        component: "PrivacyPage"
      });
    });
  }, []);

  if (!html) {
    return (
      <div className="flex items-center justify-center min-h-screen">
        <div className="text-center">読み込み中...</div>
      </div>
    );
  }

  return (
    <div className="max-w-[720px] mx-auto px-4 py-8">
      <div className="prose prose-slate max-w-none">
        <div className="overflow-x-auto">
          <div dangerouslySetInnerHTML={{ __html: html }} />
        </div>
      </div>
    </div>
  );
}
